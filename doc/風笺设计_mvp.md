# 風笺设计

#### WIND LETTER结构



##### WindBase1024F

为了解决传统 Base64 在配合 Wind Letter 结构时文本过长、一条消息在聊天平台中占用空间过大、观感（视觉效果）较差的问题，我设计了 **WindBase1024F**：使用一组精心挑选的、语义负担极低的繁体生僻汉字作为字表，实现 1024 进制编码。在保证可逆与兼容的前提下，相比 Base64 明显缩短消息长度，使加密消息在聊天场景中更加紧凑、美观。

```
風颩颬颭颮颰颱颲颳颴颵颶颷颸颹颺颻颼颽颾颿飀飁飂飃飄飅飆飇飈飉飋飌颯飊飍
雲電雷霆霄霈霏霑霖霙霜霞霧霪霰霹霽霾
```

#### 收件人标识与隐私模式（Recipient Header Modes）

##### **1. 公开**

简单、传统、兼容性高，但会暴露收件人数与公钥 ID。

- 消息头中直接包含每个接收者的 **公开公钥 ID（KeyID）**，明文可见。
- 每个接收者对应一个 KeyID，外部可直接判断消息的接收人数与身份。
- 会话密钥对所有接收者共享，对每个接收者分别用其公钥加密一份并随消息发送。
- 接收者收到消息后：
  1. 根据 KeyID 精确定位自身对应的加密块；
  2. 使用自己的私钥解封会话密钥；
  3. 使用会话密钥解密正文。

##### **2. 混淆**

隐藏收件人数与身份，外界无法反推真实收件人数量与身份。

- 消息头中生成若干个「接收者标识符」（SKID），这些标识符由**真实接收者**和**随机生成的虚假接收者**混合、重排，外部无法判断真实数量与身份。

- 每个真实 SKID 的生成方式为（示意）：

  `SKID = HMAC(seed, receiver_public_key)`

  其中：

  - `seed` 由发送者与接收者通过 **DHKE（ECDH）或 KEM（Kyber）** 得到的共享密钥，再通过 HKDF（可掺入本条消息的随机 salt）派生；
  - `seed` 本身不写入消息头，不在协议中泄露。

- 虚假 SKID 为随机生成的同长度比特串，与真实 SKID 混合，使外部无法判断真假或数量。

- 消息头中的每个 SKID 都对应一个加密会话密钥块（enc_key）。

- 接收者解密流程：

  1. 使用自己的私钥与发送者公钥（或发送者的临时公钥）通过 DHKE / KEM 计算共享密钥，得到 `seed`；
  2. 本地计算自己的 `SKID`；
  3. 在消息头的 SKID 列表中查找相等项；
  4. 若匹配成功，则使用对应的加密会话密钥块解封会话密钥，并解密正文。

- 混淆方式（控制真实人数 m 与显示人数 S 的关系）：

  - 真实收件人数：`m ≥ 1`。
  - 每条消息随机选一个系数 `C`（实数，均匀随机）：
    - 若 `m ≤ 15`：`C ∈ [2.5, 3.0]`
    - 若 `m > 15`：`C ∈ [1.7, 2.2]`
  - 计算最大膨胀倍数：
    - `F_max = 1 + C / log2(m + 2)`
  - 显示人数下限（保证至少 1 个假人，且 S 不太小）：
    - `S_min = max(m + 1, 4)`
  - 显示人数上限（由膨胀系数决定）：
    - `S_max = ceil(F_max * m)`
    - 若 `S_max < S_min`，则令 `S_max = S_min`
  - 最终显示人数：
    - 在区间 `[S_min, S_max]` 内均匀随机取整数 `S`
    - 假收件人个数：`fakeCount = S - m`

